# Блок 05 — Резервное копирование

## Назначение пакета

Пакет `vpn-backup` содержит безопасные скрипты резервного копирования и восстановления конфигурации VPN-инфраструктуры. Цель — исключить риск потери PKI, конфигов и мониторинга при сбоях или миграции.

## Структура файлов


## Скрипты

### `backup.sh`

- Проверяет наличие `.norestore` маркера.
- Создаёт директорию `/var/backups/vpn-<timestamp>`.
- Копирует:
  - `/etc/openvpn`
  - `/etc/vpn-monitor`
  - `/etc/vpn-backup`
- Логирует результат через `syslog`.

### `restore.sh`

- Блокирует восстановление, если `.norestore` существует.
- Принимает путь к резервной копии как аргумент.
- Восстанавливает конфигурации в `/etc/`.
- Логирует результат через `syslog`.

## Маркер `.norestore`

Файл `/etc/vpn-backup/.norestore` предотвращает случайное восстановление. Его наличие обязательно для запуска `backup.sh` и блокирует `restore.sh`.

## Интеграция с syslog

Все действия логируются через `logger -t vpn-backup`. Примеры:


## Установка

Пакет устанавливается через `dpkg -i vpn-backup_1.0-1_all.deb`. Скрипт `postinst` делает скрипты исполняемыми.

## Примечание

Скрипты не запускаются автоматически. Восстановление требует ручного указания пути и отсутствия `.norestore`.

